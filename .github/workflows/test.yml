name: Test

on:
  workflow_run:
    workflows: ["Prod-Migrate-Database"]
    types: [completed]
    
jobs:

  test:
    name: test
    runs-on: ubuntu-latest
    environment: prod
    steps:

      - name: Checkout Repository
        uses: actions/checkout@v2
        
      - name: Get Tags
        id: tags
        run: |
          git fetch --tags
          echo "Tags fetched"      
          
      - name: Get Latest Tag
        id: latest-tag
        run: |
          latest_tag=$(git describe --tags `git rev-list --tags --max-count=1`)
          
      - name: Get release version
        id: get_release_version
        run: |
          echo "RELEASE_VERSION=${GITHUB_REF#refs/tags/}"
          echo "RELEASE_VERSION=${GITHUB_REF#refs/*/}"
          echo "RELEASE_VERSION=${{ github.ref_name }}"
          echo "RELEASE_VERSION=${{ github.event.release.tag_name }}"
          echo "RELEASE_VERSION=$GITHUB_REF_NAME"
          echo "GIT_TAG=`echo $(git describe --tags --abbrev=0)`"
          
